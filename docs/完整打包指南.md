# è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ - å®Œæ•´æ‰“åŒ…æŒ‡å—

## ğŸ“‹ ç›®å½•
- [é—®é¢˜è¯Šæ–­](#é—®é¢˜è¯Šæ–­)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
- [æ‰“åŒ…æ­¥éª¤](#æ‰“åŒ…æ­¥éª¤)
- [å¸¸è§é”™è¯¯åŠè§£å†³](#å¸¸è§é”™è¯¯åŠè§£å†³)
- [æµ‹è¯•æ¸…å•](#æµ‹è¯•æ¸…å•)

---

## ğŸ” é—®é¢˜è¯Šæ–­

### ä¹‹å‰æ‰“åŒ…å¤±è´¥çš„ä¸»è¦åŸå› 

1. **PyQtç‰ˆæœ¬ä¸åŒ¹é…** âš ï¸
   - ä»£ç ä½¿ç”¨: `PyQt6`
   - requirements.txtå†™çš„: `PyQt5`
   - ç³»ç»Ÿå®‰è£…çš„: `PyQt5`
   - **ç»“æœ**: æ‰“åŒ…æ—¶æ‰¾ä¸åˆ°PyQt6æ¨¡å—

2. **ä¾èµ–ä¸å®Œæ•´**
   - ç¼ºå°‘matplotlibçš„backendé…ç½®
   - torch/ultralyticsçš„å­æ¨¡å—æœªå®Œå…¨æ”¶é›†
   - ç¼ºå°‘å¿…è¦çš„hidden imports

3. **æ¨¡å‹æ–‡ä»¶è·¯å¾„é—®é¢˜**
   - æ–‡æ¡£è¯´çš„æ˜¯ `yolov8n-pose.pt`
   - å®é™…ä½¿ç”¨çš„æ˜¯ `yolov8m-pose.pt`

---

## âœ… è§£å†³æ–¹æ¡ˆ

### å·²ä¿®å¤çš„æ–‡ä»¶

1. **requirements.txt** - å·²æ›´æ–°ä¸ºPyQt6
2. **è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.spec** - å®Œå–„äº†ä¾èµ–æ”¶é›†
3. **build_macos_improved.sh** - æ–°çš„æ”¹è¿›æ‰“åŒ…è„šæœ¬
4. **pre_build_check.sh** - æ‰“åŒ…å‰æ£€æŸ¥è„šæœ¬

---

## ğŸš€ æ‰“åŒ…æ­¥éª¤

### æ–¹æ³•1: ä½¿ç”¨æ”¹è¿›çš„æ‰“åŒ…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x pre_build_check.sh
chmod +x build_macos_improved.sh

# 2. è¿è¡Œæ‰“åŒ…è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒï¼‰
./build_macos_improved.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨æ‰“åŒ…

```bash
# 1. è¿è¡Œæ‰“åŒ…å‰æ£€æŸ¥
./pre_build_check.sh

# 2. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œå®‰è£…/æ›´æ–°ä¾èµ–
pip3 install --upgrade pip
pip3 install -r requirements.txt

# 3. æ¸…ç†æ—§æ–‡ä»¶
rm -rf build dist *.spec

# 4. ä½¿ç”¨specæ–‡ä»¶æ‰“åŒ…
pyinstaller è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.spec

# 5. è®¾ç½®æƒé™
chmod +x "dist/è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.app/Contents/MacOS/è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ"
```

---

## âš ï¸ å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯1: ModuleNotFoundError: No module named 'PyQt6'

**åŸå› **: ç³»ç»Ÿå®‰è£…çš„æ˜¯PyQt5ï¼Œä¸æ˜¯PyQt6

**è§£å†³**:
```bash
pip3 uninstall PyQt5 PyQt5-Qt5 PyQt5-sip
pip3 install PyQt6
```

### é”™è¯¯2: æ‰“åŒ…åè¿è¡Œé—ªé€€

**å¯èƒ½åŸå› **:
1. æ¨¡å‹æ–‡ä»¶æœªæ­£ç¡®æ‰“åŒ…
2. Qtæ’ä»¶è·¯å¾„é—®é¢˜
3. ç¼ºå°‘å¿…è¦çš„åŠ¨æ€åº“

**è§£å†³**:
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh "dist/è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.app/Contents/MacOS/yolov8m-pose.pt"

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
./dist/è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.app/Contents/MacOS/è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ
```

### é”™è¯¯3: ImportError: cannot import name 'FigureCanvasQTAgg'

**åŸå› **: matplotlib backendé…ç½®é—®é¢˜

**è§£å†³**: å·²åœ¨specæ–‡ä»¶ä¸­æ·»åŠ äº†matplotlibå­æ¨¡å—æ”¶é›†

### é”™è¯¯4: torchç›¸å…³é”™è¯¯

**åŸå› **: torchçš„C++æ‰©å±•æœªæ­£ç¡®æ‰“åŒ…

**è§£å†³**: å·²åœ¨specæ–‡ä»¶ä¸­æ·»åŠ äº† `collect_all('torch')`

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### æ‰“åŒ…å‰æµ‹è¯•

- [ ] è¿è¡Œ `./pre_build_check.sh` å…¨éƒ¨é€šè¿‡
- [ ] è¿è¡Œ `python3 gui_main.py` èƒ½æ­£å¸¸å¯åŠ¨GUI
- [ ] ç¡®è®¤æ¨¡å‹æ–‡ä»¶ `yolov8m-pose.pt` å­˜åœ¨
- [ ] ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²å®‰è£…

### æ‰“åŒ…åæµ‹è¯•

- [ ] åº”ç”¨ç¨‹åºèƒ½æ­£å¸¸å¯åŠ¨
- [ ] èƒ½é€‰æ‹©è§†é¢‘æ–‡ä»¶
- [ ] èƒ½å¼€å§‹å¤„ç†è§†é¢‘
- [ ] èƒ½æ˜¾ç¤ºå¤„ç†è¿›åº¦
- [ ] èƒ½æŸ¥çœ‹æ ‡æ³¨è§†é¢‘
- [ ] èƒ½å¯¼å‡ºCSVæŠ¥å‘Š
- [ ] èƒ½æŸ¥çœ‹ç»Ÿè®¡å›¾è¡¨

---

## ğŸ“¦ æ‰“åŒ…ç»“æœè¯´æ˜

### æ–‡ä»¶ç»“æ„
```
dist/
â””â”€â”€ è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ.app/
    â””â”€â”€ Contents/
        â”œâ”€â”€ MacOS/
        â”‚   â”œâ”€â”€ è¯¾å ‚ä¸“æ³¨åº¦æ£€æµ‹ç³»ç»Ÿ  (ä¸»ç¨‹åº)
        â”‚   â””â”€â”€ yolov8m-pose.pt     (æ¨¡å‹æ–‡ä»¶)
        â”œâ”€â”€ Resources/
        â””â”€â”€ Info.plist
```

### é¢„æœŸå¤§å°
- åº”ç”¨ç¨‹åºæ€»å¤§å°: çº¦ 800MB - 1.5GB
- åŒ…å«å®Œæ•´çš„Pythonè¿è¡Œæ—¶ã€PyTorchã€æ‰€æœ‰ä¾èµ–åº“

### åˆ†å‘è¯´æ˜
1. å¯ä»¥ç›´æ¥åˆ†äº« `.app` æ–‡ä»¶
2. å»ºè®®å‹ç¼©ååˆ†äº«ï¼ˆå¯å‡å°åˆ°çº¦500MBï¼‰
3. ç”¨æˆ·é¦–æ¬¡è¿è¡Œéœ€è¦å³é”®->æ‰“å¼€ï¼ˆmacOSå®‰å…¨é™åˆ¶ï¼‰

---

## ğŸ”§ é«˜çº§é…ç½®

### å‡å°åº”ç”¨ä½“ç§¯

å¦‚æœéœ€è¦å‡å°åº”ç”¨å¤§å°ï¼Œå¯ä»¥åœ¨specæ–‡ä»¶ä¸­æ·»åŠ :

```python
excludes=[
    'PySide6', 'PySide2', 'PyQt5',
    'tkinter',
    'IPython', 'jupyter', 'notebook',
    'pytest', 'sphinx',
    'matplotlib.tests',  # æ’é™¤æµ‹è¯•æ–‡ä»¶
    'numpy.tests',
    'torch.test',
]
```

### æ·»åŠ åº”ç”¨å›¾æ ‡

```bash
# åœ¨æ‰“åŒ…å‘½ä»¤ä¸­æ·»åŠ 
--icon=app_icon.icns
```

### å¯ç”¨è°ƒè¯•æ¨¡å¼

å¦‚æœæ‰“åŒ…åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¯ç”¨æ§åˆ¶å°è¾“å‡º:

åœ¨specæ–‡ä»¶ä¸­ä¿®æ”¹:
```python
exe = EXE(
    ...
    console=True,  # æ”¹ä¸ºTrue
    ...
)
```

---

## ğŸ“ æ•…éšœæ’æŸ¥

### å¦‚æœæ‰“åŒ…ä»ç„¶å¤±è´¥

1. **æŸ¥çœ‹å®Œæ•´é”™è¯¯æ—¥å¿—**
   ```bash
   ./build_macos_improved.sh 2>&1 | tee build.log
   ```

2. **æ£€æŸ¥Pythonç¯å¢ƒ**
   ```bash
   which python3
   python3 --version
   pip3 list
   ```

3. **å°è¯•è™šæ‹Ÿç¯å¢ƒ**
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ./build_macos_improved.sh
   ```

4. **æ¸…ç†ç¼“å­˜é‡è¯•**
   ```bash
   rm -rf build dist __pycache__ *.spec
   pip3 cache purge
   ./build_macos_improved.sh
   ```

---

## ğŸ“š å‚è€ƒèµ„æº

- [PyInstallerå®˜æ–¹æ–‡æ¡£](https://pyinstaller.org/)
- [PyQt6æ–‡æ¡£](https://www.riverbankcomputing.com/static/Docs/PyQt6/)
- [Ultralyticsæ‰“åŒ…æŒ‡å—](https://docs.ultralytics.com/guides/pyinstaller/)

